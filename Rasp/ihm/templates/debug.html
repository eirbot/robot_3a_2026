<!DOCTYPE html>
<html>
<head>
    <title>DEBUG & CONFIG</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/script.js" defer></script>
</head>
<body class="mode-BLEUE">
    <div class="header">
        <a href="/" class="btn-back">‚Üê Accueil</a>
        <div style="font-weight:bold;">DEBUG & CONFIG</div>
        <div class="sys-info" id="sys-info">...</div>
    </div>

    <div class="debug-grid">
        <div class="card" style="grid-column: span 2;">
            <h3>Consommation (A)</h3>
            <canvas id="currentChart" height="100"></canvas>
        </div>

        <div class="card">
            <h3>üîå √âtat P√©riph√©riques</h3>
            <div class="dev-status">
                <span>LiDAR</span>
                <div id="status-lidar" class="status-dot"></div>
            </div>
            <div class="dev-status">
                <span>ESP Moteurs</span>
                <div id="status-esp_motors" class="status-dot"></div>
            </div>
            <div class="dev-status">
                <span>ESP Bras</span>
                <div id="status-esp_arms" class="status-dot"></div>
            </div>
            <div class="dev-status">
                <span>Cam√©ra (MIPI)</span>
                <div id="status-camera" class="status-dot"></div>
            </div>
        </div>

        <div class="card">
            <h3>üõ†Ô∏è Config Match</h3>
            <div class="switch-row"><label>LiDAR :</label><input type="checkbox" id="chk-lidar" onchange="sendConfigUpdate()"></div>
            <div class="switch-row"><label>Musique :</label><input type="checkbox" id="chk-music" onchange="sendConfigUpdate()"></div>
            <div class="switch-row"><label>LEDs :</label><input type="checkbox" id="chk-leds" onchange="sendConfigUpdate()"></div>
            <div class="switch-row"><label>Score Manuel :</label><input type="checkbox" id="chk-score" onchange="sendConfigUpdate()"></div>
            <hr style="border-color:#444">
            <div class="switch-row">
                <label>Mode Strat :</label>
                <select id="sel-strat-mode" onchange="sendConfigUpdate()">
                    <option value="DYNAMIC">Dynamique</option>
                    <option value="STATIC">En Dur</option>
                </select>
            </div>
            <div class="switch-row" id="row-strat-id" style="display:none;">
                <label>Num√©ro :</label>
                <select id="sel-strat-id" class="input-dark">
                    <option value="" disabled>Chargement...</option>
                </select>
            </div>
        </div>

        <div class="card" style="grid-column: span 2;">
            <h3>üíª Console S√©rie ESP</h3>
            <div style="margin-bottom:10px;">
                <select id="serial-port" style="width:100%; padding:8px; margin-bottom:5px;">
                    {% for p in ports %}
                    <option value="{{p}}">{{p}}</option>
                    {% else %}
                    <option value="/dev/ttyUSB0">/dev/ttyUSB0</option>
                    {% endfor %}
                </select>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="serial-cmd" placeholder="Commande (ex: HELP)" style="flex:1; padding:8px;">
                    <button class="btn-tiny" onclick="sendSerial()" style="padding:8px;">Envoyer</button>
                </div>
            </div>
            <div id="serial-output" style="background:#000; color:#0f0; height:150px; overflow-y:auto; padding:10px; font-family:monospace; font-size:0.8em; border:1px solid #444;">
                > Pr√™t.
            </div>
        </div>

        <div class="card" style="grid-column: span 2;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3>üìú Logs Syst√®me (Live)</h3>
                <button class="btn-tiny" onclick="clearLogs()" style="background:#d32f2f;">Effacer</button>
            </div>
            
            <div id="log-container" class="log-terminal">
                <div class="log-line"><span class="log-time">--:--:--</span> <span class="log-info">Interface Pr√™te. En attente de logs...</span></div>
            </div>
        </div>

        <div class="card" style="grid-column: span 2;">
            <h3>‚ö° Syst√®me</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button id="btn-flash-motors" onclick="flashESP('motors')" class="btn-flash">Flash MOTEURS</button>
                <button id="btn-flash-arms" onclick="flashESP('arms')" class="btn-flash">Flash BRAS</button>
            </div>
            <a href="/media" class="btn-nav" style="background-color:#673AB7;">üéµ G√âRER SONS & LEDS</a>
            <a href="/map" class="btn-nav">üó∫Ô∏è VOIR CARTE</a>
        </div>

        <div class="card" style="grid-column: span 2;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3>üì∑ Retour Vid√©o</h3>
                <button class="btn-tiny" onclick="reloadCam()">Rafra√Æchir</button>
            </div>
            
            <div class="camera-container">
                <img id="cam-feed" src="/video_feed" alt="Cam√©ra non disponible ou d√©connect√©e" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="cam-error" style="display:none; color:#F44336; padding:20px;">
                    ‚ö†Ô∏è Pas de signal vid√©o
                </div>
            </div>
        </div>
    </div>
</body>
</html>